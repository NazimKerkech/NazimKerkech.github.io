!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pseudocode=e()}}(function(){return function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var p=n[s]={exports:{}};t[s][0].call(p.exports,function(e){var n=t[s][1][e];return r(n||e)},p,p.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t){var n=e("./src/ParseError"),i=e("./src/Lexer"),r=e("./src/Parser"),o=e("./src/Renderer");t.exports={ParseError:n,renderToString:function(e,t){if(null===e||e===undefined)throw"input cannot be empty";var n=new i(e),s=new r(n);return new o(s,t).toMarkup()},render:function(e,t,n){if(null===e||e===undefined)throw"input cannot be empty";var s=new i(e),a=new r(s),l=new o(a,n).toDOM();return t&&t.appendChild(l),l}}},{"./src/Lexer":2,"./src/ParseError":3,"./src/Parser":4,"./src/Renderer":5}],2:[function(e,t){var n=e("./utils"),i=e("./ParseError"),r=function(e){this._input=e,this._remain=e,this._pos=0,this._nextAtom=this._currentAtom=null,this._next()};r.prototype.accept=function(e,t){return this._nextAtom.type===e&&this._matchText(t)?(this._next(),this._currentAtom.text):null},r.prototype.expect=function(e,t){var n=this._nextAtom;if(n.type!==e)throw new i("Expect an atom of "+e+" but received "+n.type,this._pos,this._input);if(!this._matchText(t))throw new i("Expect `"+t+"` but received `"+n.text+"`",this._pos,this._input);return this._next(),this._currentAtom.text},r.prototype.get=function(){return this._currentAtom};var o={special:/^(\\\\|\\{|\\}|\\\$|\\&|\\#|\\%|\\_)/,math:{exec:function(e){for(var t=[{start:"$",end:"$"},{start:"\\(",end:"\\)"}],n=e.length,r=0;r<t.length;r++){var o=t[r].start;if(0===e.indexOf(o))for(var s=t[r].end,a=o.length,l=e.slice(a);a<n;){var h=l.indexOf(s);if(h<0)throw new i("Math environment is not closed",this._pos,this._input);if(!(h>0&&"\\"===l[h-1]))return[e.slice(0,a+h+s.length),e.slice(o.length,a+h)];var p=h+s.length;l=l.slice(p),a+=p}}return null}},func:/^\\([a-zA-Z]+)/,open:/^\{/,close:/^\}/,quote:/^(`|``|'|'')/,ordinary:/^[^\\{}$&#%_\s]+/},s=/^%.*/,a=/^\s+/;r.prototype._skip=function(e){this._pos+=e,this._remain=this._remain.slice(e)},r.prototype._next=function(){for(var e=!1;;){var t=a.exec(this._remain);if(t){e=!0;var n=t[0].length;this._skip(n)}var r=s.exec(this._remain);if(!r)break;var l=r[0].length;this._skip(l)}if(this._currentAtom=this._nextAtom,""===this._remain)return this._nextAtom={type:"EOF",text:null,whitespace:!1},!1;for(var h in o){var p=o[h].exec(this._remain);if(p){var u=p[0],c=p[1]?p[1]:u;return this._nextAtom={type:h,text:c,whitespace:e},this._pos+=u.length,this._remain=this._remain.slice(p[0].length),!0}}throw new i("Unrecoganizable atom",this._pos,this._input)},r.prototype._matchText=function(e){return null===e||e===undefined||(n.isString(e)?e.toLowerCase()===this._nextAtom.text.toLowerCase():(e=e.map(function(e){return e.toLowerCase()})).indexOf(this._nextAtom.text.toLowerCase())>=0)},t.exports=r},{"./ParseError":3,"./utils":6}],3:[function(e,t){function n(e,t,n){var i="Error: "+e;if(t!==undefined&&n!==undefined){i+=" at position "+t+": `",n=n.slice(0,t)+"\u21b1"+n.slice(t);var r=Math.max(0,t-15),o=t+15;i+=n.slice(r,o)+"`"}this.message=i}n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,t.exports=n},{}],4:[function(e,t){var n=e("./utils"),i=function(e,t){this.type=e,this.value=t,this.children=[]};i.prototype.toString=function(e){e||(e=0);for(var t="",i=0;i<e;i++)t+="  ";var r=t+"<"+this.type+">";if(this.value&&(r+=" ("+n.toString(this.value)+")"),r+="\n",this.children)for(var o=0;o<this.children.length;o++){r+=this.children[o].toString(e+1)}return r},i.prototype.addChild=function(e){if(!e)throw"argument cannot be null";this.children.push(e)};var r=function(e,t,n){this.type=e,this.value=t,this.children=null,this.whitespace=!!n};r.prototype=i.prototype;var o=function(e){this._lexer=e};o.prototype.parse=function(){for(var e=new i("root");;){var t,n=this._acceptEnvironment();if(null===n)break;if("algorithm"===n)t=this._parseAlgorithmInner();else{if("algorithmic"!==n)throw new ParseError("Unexpected environment "+n);t=this._parseAlgorithmicInner()}this._closeEnvironment(n),e.addChild(t)}return this._lexer.expect("EOF"),e},o.prototype._acceptEnvironment=function(){var e=this._lexer;if(!e.accept("func","begin"))return null;e.expect("open");var t=e.expect("ordinary");return e.expect("close"),t},o.prototype._closeEnvironment=function(e){var t=this._lexer;t.expect("func","end"),t.expect("open"),t.expect("ordinary",e),t.expect("close")},o.prototype._parseAlgorithmInner=function(){for(var e=new i("algorithm");;){var t=this._acceptEnvironment();if(null===t){var n=this._parseCaption();if(!n)break;e.addChild(n)}else{if("algorithmic"!==t)throw new ParseError("Unexpected environment "+t);var r=this._parseAlgorithmicInner();this._closeEnvironment(),e.addChild(r)}}return e},o.prototype._parseAlgorithmicInner=function(){for(var e,t=new i("algorithmic");;)if(e=this._parseCommand(s))t.addChild(e);else{if(!((e=this._parseBlock()).children.length>0))break;t.addChild(e)}return t},o.prototype._parseCaption=function(){var e=this._lexer;if(!e.accept("func","caption"))return null;var t=new i("caption");return e.expect("open"),t.addChild(this._parseCloseText()),e.expect("close"),t},o.prototype._parseBlock=function(){for(var e=new i("block");;){var t=this._parseControl();if(t)e.addChild(t);else{var n=this._parseFunction();if(n)e.addChild(n);else{var r=this._parseCommand(a);if(r)e.addChild(r);else{var o=this._parseComment();if(!o)break;e.addChild(o)}}}}return e},o.prototype._parseControl=function(){var e;return(e=this._parseIf())?e:(e=this._parseLoop())?e:void 0},o.prototype._parseFunction=function(){var e=this._lexer;if(!e.accept("func",["function","procedure"]))return null;var t=this._lexer.get().text;e.expect("open");var n=e.expect("ordinary");e.expect("close"),e.expect("open");var r=this._parseCloseText();e.expect("close");var o=this._parseBlock();e.expect("func","end"+t);var s=new i("function",{type:t,name:n});return s.addChild(r),s.addChild(o),s},o.prototype._parseIf=function(){if(!this._lexer.accept("func","if"))return null;var e=new i("if");this._lexer.expect("open"),e.addChild(this._parseCond()),this._lexer.expect("close"),e.addChild(this._parseBlock());for(var t=0;this._lexer.accept("func",["elif","elsif","elseif"]);)this._lexer.expect("open"),e.addChild(this._parseCond()),this._lexer.expect("close"),e.addChild(this._parseBlock()),t++;var n=!1;return this._lexer.accept("func","else")&&(n=!0,e.addChild(this._parseBlock())),this._lexer.expect("func","endif"),e.value={numElif:t,hasElse:n},e},o.prototype._parseLoop=function(){if(!this._lexer.accept("func",["FOR","FORALL","WHILE"]))return null;var e=this._lexer.get().text.toLowerCase(),t=new i("loop",e);this._lexer.expect("open"),t.addChild(this._parseCond()),this._lexer.expect("close"),t.addChild(this._parseBlock());var n="forall"!==e?"end"+e:"endfor";return this._lexer.expect("func",n),t};var s=["ensure","require"],a=["state","print","return"];o.prototype._parseCommand=function(e){if(!this._lexer.accept("func",e))return null;var t=this._lexer.get().text.toLowerCase(),n=new i("command",t);return n.addChild(this._parseOpenText()),n},o.prototype._parseComment=function(){if(!this._lexer.accept("func","comment"))return null;var e=new i("comment");return this._lexer.expect("open"),e.addChild(this._parseCloseText()),this._lexer.expect("close"),e},o.prototype._parseCall=function(){var e=this._lexer;if(!e.accept("func","call"))return null;var t=e.get().whitespace;e.expect("open");var n=e.expect("ordinary");e.expect("close");var r=new i("call");r.whitespace=t,r.value=n,e.expect("open");var o=this._parseCloseText();return r.addChild(o),e.expect("close"),r},o.prototype._parseCond=o.prototype._parseCloseText=function(){return this._parseText("close")},o.prototype._parseOpenText=function(){return this._parseText("open")},o.prototype._parseText=function(e){for(var t,n=new i(e+"-text"),r=!1;;)if(t=this._parseAtom()||this._parseCall())r&&(t.whitespace|=r),n.addChild(t);else{if(!this._lexer.accept("open"))break;t=this._parseCloseText(),r=this._lexer.get().whitespace,t.whitespace=r,n.addChild(t),this._lexer.expect("close"),r=this._lexer.get().whitespace}return n};var l={ordinary:{tokenType:"ordinary"},math:{tokenType:"math"},special:{tokenType:"special"},"cond-symbol":{tokenType:"func",tokenValues:["and","or","not","true","false","to"]},"quote-symbol":{tokenType:"quote"},"sizing-dclr":{tokenType:"func",tokenValues:["tiny","scriptsize","footnotesize","small","normalsize","large","Large","LARGE","huge","Huge"]},"font-dclr":{tokenType:"func",tokenValues:["normalfont","rmfamily","sffamily","ttfamily","upshape","itshape","slshape","scshape","bfseries","mdseries","lfseries"]},"font-cmd":{tokenType:"func",tokenValues:["textnormal","textrm","textsf","texttt","textup","textit","textsl","textsc","uppercase","lowercase","textbf","textmd","textlf"]},"text-symbol":{tokenType:"func",tokenValues:["textbackslash"]}};o.prototype._parseAtom=function(){for(var e in l){var t=l[e],n=this._lexer.accept(t.tokenType,t.tokenValues);if(null!==n){var i=this._lexer.get().whitespace;return"ordinary"!==e&&"math"!==e&&(n=n.toLowerCase()),new r(e,n,i)}}return null},t.exports=o},{"./utils":6}],5:[function(e,t){function n(e){this._css={},this._fontSize=this._outerFontSize=e!==undefined?e:1}function i(e,t){this._nodes=e,this._textStyle=t}function r(){this._body=[],this._textBuf=[]}function o(e){e=e||{},this.indentSize=e.indentSize?this._parseEmVal(e.indentSize):1.2,this.commentDelimiter=e.commentDelimiter||" // ",this.lineNumberPunc=e.lineNumberPunc||":",this.lineNumber=e.lineNumber!==undefined&&e.lineNumber,this.noEnd=e.noEnd!==undefined&&e.noEnd,e.captionCount!==undefined&&(s.captionCount=e.captionCount)}function s(e,t){this._root=e.parse(),this._options=new o(t),this._openLine=!1,this._blockLevel=0,this._textLevel=-1,this._globalTextStyle=new n}var a=e("./utils");n.prototype.outerFontSize=function(e){return e!==undefined&&(this._outerFontSize=e),this._outerFontSize},n.prototype.fontSize=function(){return this._fontSize},n.prototype._fontCommandTable={normalfont:{"font-family":"KaTeX_Main"},rmfamily:{"font-family":"KaTeX_Main"},sffamily:{"font-family":"KaTeX_SansSerif"},ttfamily:{"font-family":"KaTeX_Typewriter"},bfseries:{"font-weight":"bold"},mdseries:{"font-weight":"medium"},lfseries:{"font-weight":"lighter"},upshape:{"font-style":"normal","font-variant":"normal"},itshape:{"font-style":"italic","font-variant":"normal"},scshape:{"font-style":"normal","font-variant":"small-caps"},slshape:{"font-style":"oblique","font-variant":"normal"},textnormal:{"font-family":"KaTeX_Main"},textrm:{"font-family":"KaTeX_Main"},textsf:{"font-family":"KaTeX_SansSerif"},texttt:{"font-family":"KaTeX_Typewriter"},textbf:{"font-weight":"bold"},textmd:{"font-weight":"medium"},textlf:{"font-weight":"lighter"},textup:{"font-style":"normal","font-variant":"normal"},textit:{"font-style":"italic","font-variant":"normal"},textsc:{"font-style":"normal","font-variant":"small-caps"},textsl:{"font-style":"oblique","font-variant":"normal"},uppercase:{"text-transform":"uppercase"},lowercase:{"text-transform":"lowercase"}},n.prototype._sizingScalesTable={tiny:.68,scriptsize:.8,footnotesize:.85,small:.92,normalsize:1,large:1.17,Large:1.41,LARGE:1.58,huge:1.9,Huge:2.28},n.prototype.updateByCommand=function(e){var t=this._fontCommandTable[e];if(t===undefined){var n=this._sizingScalesTable[e];if(n!==undefined)return this._outerFontSize=this._fontSize,void(this._fontSize=n);throw new ParserError("unrecogniazed text-style command")}for(var i in t)this._css[i]=t[i]},n.prototype.toCSS=function(){var e="";for(var t in this._css){var n=this._css[t];n!==undefined&&(e+=t+":"+n+";")}return this._fontSize!==this._outerFontSize&&(e+="font-size:"+this._fontSize/this._outerFontSize+"em;"),e},i.prototype._renderCloseText=function(e){var t=new n(this._textStyle.fontSize()),r=new i(e.children,t);e.whitespace&&this._html.putText(" "),this._html.putSpan(r.renderToHTML())},i.prototype.renderToHTML=function(){var t;for(this._html=new r;(t=this._nodes.shift())!==undefined;){var o=t.type,s=t.value;switch(t.whitespace&&this._html.putText(" "),o){case"ordinary":this._html.putText(s);break;case"math":if(!katex)try{katex=e("katex")}catch(m){throw"katex is required to render math"}var a=katex.renderToString(s);this._html.putSpan(a);break;case"cond-symbol":this._html.beginSpan("ps-keyword").putText(s.toLowerCase()).endSpan();break;case"special":if("\\\\"===s){this._html.putHTML("<br/>");break}var l={"\\{":"{","\\}":"}","\\$":"$","\\&":"&","\\#":"#","\\%":"%","\\_":"_"}[s];this._html.putText(l);break;case"text-symbol":var h={textbackslash:"\\"}[s];this._html.putText(h);break;case"quote-symbol":var p={"`":"\u2018","``":"\u201c","'":"\u2019","''":"\u201d"}[s];this._html.putText(p);break;case"call":this._html.beginSpan("ps-funcname").putText(s).endSpan(),this._html.write("(");var u=t.children[0];this._renderCloseText(u),this._html.write(")");break;case"close-text":this._renderCloseText(t);break;case"font-dclr":case"sizing-dclr":this._textStyle.updateByCommand(s),this._html.beginSpan(null,this._textStyle.toCSS());var c=new i(this._nodes,this._textStyle);this._html.putSpan(c.renderToHTML()),this._html.endSpan();break;case"font-cmd":var f=this._nodes[0];if("close-text"!==f.type)continue;var d=new n(this._textStyle.fontSize());d.updateByCommand(s),this._html.beginSpan(null,d.toCSS());var _=new i(f.children,d);this._html.putSpan(_.renderToHTML()),this._html.endSpan();break;default:throw new ParseError("Unexpected ParseNode of type "+t.type)}}return this._html.toMarkup()},r.prototype.beginDiv=function(e,t,n){return this._beginTag("div",e,t,n),this._body.push("\n"),this},r.prototype.endDiv=function(){return this._endTag("div"),this._body.push("\n"),this},r.prototype.beginP=function(e,t,n){return this._beginTag("p",e,t,n),this._body.push("\n"),this},r.prototype.endP=function(){return this._flushText(),this._endTag("p"),this._body.push("\n"),this},r.prototype.beginSpan=function(e,t,n){return this._flushText(),this._beginTag("span",e,t,n)},r.prototype.endSpan=function(){return this._flushText(),this._endTag("span")},r.prototype.putHTML=r.prototype.putSpan=function(e){return this._flushText(),this._body.push(e),this},r.prototype.putText=function(e){return this._textBuf.push(e),this},r.prototype.write=function(e){this._body.push(e)},r.prototype.toMarkup=function(){return this._flushText(),this._body.join("").trim()},r.prototype.toDOM=function(){var e=this.toMarkup(),t=document.createElement("div");return t.innerHTML=e,t.firstChild},r.prototype._flushText=function(){if(0!==this._textBuf.length){var e=this._textBuf.join("");this._body.push(this._escapeHtml(e)),this._textBuf=[]}},r.prototype._beginTag=function(e,t,n,i){var r="<"+e;if(t&&(r+=' class="'+t+'"'),n){var o;if(a.isString(n))o=n;else for(var s in o="",n)attrVal=n[s],o+=s+":"+attrVal+";";i&&(o+=i),r+=' style="'+o+'"'}return r+=">",this._body.push(r),this},r.prototype._endTag=function(e){return this._body.push("</"+e+">"),this};var l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};r.prototype._escapeHtml=function(e){return String(e).replace(/[&<>"'\/]/g,function(e){return l[e]})},o.prototype._parseEmVal=function(e){if((e=e.trim()).indexOf("em")!==e.length-2)throw"option unit error; no `em` found";return Number(e.substring(0,e.length-2))},s.captionCount=0,s.prototype.toMarkup=function(){var e=this._html=new r;return this._buildTree(this._root),delete this._html,e.toMarkup()},s.prototype.toDOM=function(){var e=this.toMarkup(),t=document.createElement("div");return t.innerHTML=e,t.firstChild},s.prototype._beginGroup=function(e,t,n){this._closeLineIfAny(),this._html.beginDiv("ps-"+e+(t?" "+t:""),n)},s.prototype._endGroup=function(){this._closeLineIfAny(),this._html.endDiv()},s.prototype._beginBlock=function(){var e=this._options.lineNumber&&0===this._blockLevel?.6:0,t=this._options.indentSize+e;this._beginGroup("block",null,{"margin-left":t+"em"}),this._blockLevel++},s.prototype._endBlock=function(){this._closeLineIfAny(),this._endGroup(),this._blockLevel--},s.prototype._newLine=function(){this._closeLineIfAny(),this._openLine=!0,this._globalTextStyle.outerFontSize(1);var e=this._options.indentSize;this._blockLevel>0?(this._numLOC++,this._html.beginP("ps-line ps-code",this._globalTextStyle.toCSS()),this._options.lineNumber&&this._html.beginSpan("ps-linenum",{left:-(this._blockLevel-1)*(1.25*e)+"em"}).putText(this._numLOC+this._options.lineNumberPunc).endSpan()):this._html.beginP("ps-line",{"text-indent":-e+"em","padding-left":e+"em"},this._globalTextStyle.toCSS())},s.prototype._closeLineIfAny=function(){this._openLine&&(this._html.endP(),this._openLine=!1)},s.prototype._typeKeyword=function(e){this._html.beginSpan("ps-keyword").putText(e).endSpan()},s.prototype._typeFuncName=function(e){this._html.beginSpan("ps-funcname").putText(e).endSpan()},s.prototype._typeText=function(e){this._html.write(e)},s.prototype._buildTreeForAllChildren=function(e){for(var t=e.children,n=0;n<t.length;n++)this._buildTree(t[n])},s.prototype._buildCommentsFromBlock=function(e){for(var t=e.children;t.length>0&&"comment"===t[0].type;){var n=t.shift();this._buildTree(n)}},s.prototype._buildTree=function(e){var t,r,o;switch(e.type){case"root":this._beginGroup("root"),this._buildTreeForAllChildren(e),this._endGroup();break;case"algorithm":var a;for(t=0;t<e.children.length;t++)"caption"===(r=e.children[t]).type&&(a=r,s.captionCount++);for(a?(this._beginGroup("algorithm","with-caption"),this._buildTree(a)):this._beginGroup("algorithm"),t=0;t<e.children.length;t++)"caption"!==(r=e.children[t]).type&&this._buildTree(r);this._endGroup();break;case"algorithmic":this._options.lineNumber?(this._beginGroup("algorithmic","with-linenum"),this._numLOC=0):this._beginGroup("algorithmic"),this._buildTreeForAllChildren(e),this._endGroup();break;case"block":this._beginBlock(),this._buildTreeForAllChildren(e),this._endBlock();break;case"function":var l=e.value.type.toLowerCase(),h=e.value.name;o=e.children[0];var p=e.children[1];this._newLine(),this._typeKeyword(l+" "),this._typeFuncName(h),this._typeText("("),this._buildTree(o),this._typeText(")"),this._buildCommentsFromBlock(p),this._buildTree(p),this._options.noEnd||(this._newLine(),this._typeKeyword("end "+l));break;case"if":this._newLine(),this._typeKeyword("if "),ifCond=e.children[0],this._buildTree(ifCond),this._typeKeyword(" then");var u=e.children[1];this._buildCommentsFromBlock(u),this._buildTree(u);for(var c=e.value.numElif,f=0;f<c;f++){this._newLine(),this._typeKeyword("else if ");var d=e.children[2+2*f];this._buildTree(d),this._typeKeyword(" then");var _=e.children[2+2*f+1];this._buildCommentsFromBlock(_),this._buildTree(_)}if(e.value.hasElse){this._newLine(),this._typeKeyword("else");var m=e.children[e.children.length-1];this._buildCommentsFromBlock(m),this._buildTree(m)}this._options.noEnd||(this._newLine(),this._typeKeyword("end if"));break;case"loop":this._newLine();var y=e.value,x={"for":"for",forall:"for all","while":"while"};this._typeKeyword(x[y]+" ");var v=e.children[0];this._buildTree(v),this._typeKeyword(" do");var b=e.children[1];if(this._buildCommentsFromBlock(b),this._buildTree(b),!this._options.noEnd){this._newLine();var g="while"===y?"end while":"end for";this._typeKeyword(g)}break;case"command":var w={state:"",ensure:"Ensure: ",require:"Require: ",print:"print ","return":"return "}[e.value];this._newLine(),w&&this._typeKeyword(w),o=e.children[0],this._buildTree(o);break;case"caption":this._newLine(),this._typeKeyword("Algorithm "+s.captionCount+" "),o=e.children[0],this._buildTree(o);break;case"comment":o=e.children[0],this._html.beginSpan("ps-comment"),this._html.putText(this._options.commentDelimiter),this._buildTree(o),this._html.endSpan();break;case"open-text":var T=new i(e.children,this._globalTextStyle);this._html.putSpan(T.renderToHTML());break;case"close-text":var C=new n(this._globalTextStyle.fontSize()),k=new i(e.children,C);this._html.putSpan(k.renderToHTML());break;default:throw new ParseError("Unexpected ParseNode of type "+e.type)}},t.exports=s},{"./utils":6,katex:undefined}],6:[function(e,t){function n(e){return"string"==typeof e||e instanceof String}function i(e){return"object"==typeof e&&e instanceof Object}function r(e){if(!i(e))return e+"";var t=[];for(var n in e)t.push(n+": "+r(e[n]));return t.join(", ")}t.exports={isString:n,isObject:i,toString:r}},{}]},{},[1])(1)});