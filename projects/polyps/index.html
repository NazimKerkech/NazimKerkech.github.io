<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Polyp localization and tracking | Nazim Kerkech </title> <meta name="author" content="Nazim Kerkech"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://nazimkerkech.github.io/projects/polyps/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> <style type="text/css">.fake-img{background:#bbb;border:1px solid rgba(0,0,0,0.1);box-shadow:0 0 4px rgba(0,0,0,0.1);margin-bottom:12px}.fake-img p{font-family:monospace;color:white;text-align:left;margin:12px 0;text-align:center;font-size:16px}</style> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Polyp localization and tracking",
            "description": "",
            "published": "April 11, 2024",
            "authors": [
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Nazim  Kerkech </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">Projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Polyp localization and tracking</h1> <p></p> </d-title> <d-article> <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js" integrity="sha512-EKW5YvKU3hpyyOcN6jQnAxO/L8gts+YdYV6Yymtl8pk9YlYFtqJgihORuRoBXK8/cOIlappdU6Ms8KdK6yBCgA==" crossorigin="anonymous" referrerpolicy="no-referrer"> </script> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.css"> <script src="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.js"> </script> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css"> <script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"> </script> <h1 id="introduction">Introduction</h1> <p>This project was given as an assignment for an image processing course. The objective was to implement a polyp localization and tracking approach for colorectal cancer screening that was proposed in <d-cite key="8759180"></d-cite>.</p> <p>Colorectal cancer manifests itself through polyps in the large intestine. It is one of the deadliest cancers. The only way to reduce mortality is through early screening by identifying polyps in a colonoscopy. However, human agents may miss polyps that could otherwise have aided in screening.</p> <p>The difficulties encountered by Computer-Aided Detection are Intra-class variations (heterogeneity) of polyps (in size, shape, and color) and The fact that often, polyps do not present a strong variation compared to the intestinal mucosa (they are homogeneous with the mucosa).</p> <p>The article proposes an improvement of a state-of-the-art method reducing jittering.</p> <h2 id="localization">Localization</h2> <p>U-net is a convolutional autoencoder, here it takes a frame from the colonoscopy video as an input and outputs a “probability map” indicating whether each pixel belongs to a polyp or not. after averaging each frame with the previous frame, a threshold of 0.5 is applied to get a binary mask indicating the location of the polyp (segmentation). Finally, we perform an erosion, then we order the components by their size and roundness. If the largest component is the roundest, we keep it and calculate its center.</p> <h2 id="tracking">Tracking</h2> <p>We used the Lucas–Kanade method to estimate the optical flow to track the polyps between each frame. If we lose track of it, we train a regression model with its previous locations to predict its location in the current frame. If the predicted location falls inside the image we keep tracking it. Otherwise we run a new localization with u-net. In the original article, They used a binary classifier CNN to test if there were indeed a polyp in the position found by the regression model.</p> <p>We stop tracking a polyp after tracking it for 10 frames or when it falls out of the image.</p> <h2 id="training">Training</h2> <p>We used the Kvasir-SEG <d-cite key="jha2020kvasir"></d-cite> dataset to train and test our emplementation.</p> <hr> <h1 id="general-specification">General specification</h1> <p>Here is a pseudo-code of the algorithm proposed in the aforementioned article.</p> <pre id="polyp" class="pseudocode">
    \begin{algorithm}
    \caption{Polyp localization and tracking}
    \begin{algorithmic}
      \INPUT Colonoscopy Video
	  \STATE $i \leftarrow 0$
	  \STATE previousFrame $\leftarrow$ first frame of the video
	  \STATE listOfPositions $\leftarrow$ []
	  \FOR{frame $\in$ Video}
	  	\IF{$i==0$}	\COMMENT{polyp detection (once every 10 frame)}
	  		\STATE mask1 $\leftarrow$ model(frame)
			\STATE mask2 $\leftarrow$ model(previousFrame)
			\STATE mask $\leftarrow$ average(mask1, mask2)
			\STATE mask.binarize(0.5)
			\STATE mask.errode()
			\STATE contours $\leftarrow$ detect contours in the mask
			\STATE sort the contours according to their size
			\STATE contour $\leftarrow$ biggest in contours
			\STATE center $\leftarrow$ contour.center()
			\STATE listOfPositions.append(center)
		\ENDIF
			\STATE opticalFlow $\leftarrow$ opticalFlow(frame, previousFrame)
			\STATE listOfPositions.append(opticalFlow(listOfPositions[-1])) 
		\IF{listOfPositions[-1] is outside of the image}
			\STATE i $\leftarrow$ 0
		\ENDIF
		\IF{there is jittering}
			\STATE train a regression model from previous positions
			\IF{it is outside of the image}
				\STATE i $\leftarrow$ 0 
			\ENDIF
		\ENDIF
		\STATE previousFrame $\leftarrow$ frame
		\STATE i $\leftarrow (i+1) \mod 10$
	  \ENDFOR
      
      \RETURN listOfPositions
    \end{algorithmic}
    \end{algorithm}
</pre> <script>pseudocode.renderElement(document.getElementById("polyp"));</script> <hr> <h1 id="results">Results</h1> <p>The figures show (from left to right) a frame of the colonoscopy, the manually defined binary mask (Ground Truth), and the binary mask generated by U-Net.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/polyps-480.webp 480w,/assets/img/polyps-800.webp 800w,/assets/img/polyps-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/polyps.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> </div> <p>We applied the system on this video. The blue dot is the polyp’s position predicted by the algorithm.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <video src="/assets/video/output.mp4" class="img-fluid rounded z-depth-1" width="auto" height="auto" autoplay="" controls=""></video> </figure> </div> </div> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/2024-Projects.bib"></d-bibliography> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Nazim Kerkech. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: April 11, 2024. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>